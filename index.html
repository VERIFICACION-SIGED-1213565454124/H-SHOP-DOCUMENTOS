<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Documentos - Estatus de Solicitud</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* Estilos generales */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 850px; 
            margin: 0 auto; 
            padding: 25px; 
            background-color: #f4f4f9; 
            position: relative; 
            padding-bottom: 100px; 
        }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 25px; }
        .input-group, .form-section { background-color: #ffffff; padding: 20px; margin-bottom: 25px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        h2 { color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px; margin-bottom: 15px; }
        label { display: block; margin-top: 10px; font-weight: bold; color: #555; }
        input[type="text"], input[type="date"], textarea, input[type="file"], input[type="password"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .date-container { display: flex; justify-content: space-between; gap: 10px; }
        .date-container input { width: 100%; }
        textarea { height: 120px; resize: vertical; }
        
        /* Botones generales */
        .btn-action {
            background-color: #e67e22;
            color: white;
            padding: 15px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        .btn-action:hover { background-color: #d35400; }
        .back-button { background-color: #95a5a6; width: auto; padding: 10px 15px; font-size: 1em; }

        /* Estilos de Botones de Menú por Categoría */
        .btn-menu {
            color: white;
            padding: 15px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        .btn-carta { background-color: #f1c40f; } 
        .btn-receta { background-color: #27ae60; } 
        .btn-certificado { background-color: #3498db; } 
        .btn-especializado { background-color: #9b59b6; } 
        .btn-social { background-color: #34495e; margin-bottom: 20px; } 
        
        .btn-carta:hover { background-color: #f39c12; }
        .btn-receta:hover { background-color: #2ecc71; }
        .btn-certificado:hover { background-color: #2980b9; }
        .btn-especializado:hover { background-color: #8e44ad; }
        .btn-social:hover { background-color: #2c3e50; }

        .form-section { display: none; }
        
        /* Botón de admin discreto */
        #btn-go-admin {
            width: 100%;
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            margin-top: 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        #btn-go-admin:hover {
            background-color: #1f2a36;
        }
        
        /* Estilos de la página de estatus */
        .status-page {
            text-align: center; 
            padding: 50px; 
            background-color: #fff; 
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .status-page .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .btn-download-now {
            background-color: #27ae60;
            margin-top: 20px;
            width: 50%;
            margin: 20px auto;
        }
        
        /* Estilo para el nuevo aviso de pago */
        .payment-notice {
            background-color: #eaf7ff;
            color: #2980b9;
            padding: 10px;
            border: 1px solid #3498db;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 0.95em;
        }

        /* Estilo para el descargo de responsabilidad (Disclaimer) */
        .disclaimer-notice {
            background-color: #fcebeb;
            color: #c0392b;
            padding: 10px;
            border: 1px solid #c0392b;
            border-radius: 4px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 0.85em;
        }

        /* --- Elementos Flotantes (WhatsApp) y Fijos (Aviso de Pago Fijo) --- */
        
        /* Botón Flotante de WhatsApp */
        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 40px;
            left: 20px; 
            background-color: #25d366;
            color: #fff;
            border-radius: 50px;
            text-align: center;
            font-size: 30px;
            box-shadow: 2px 2px 3px #999;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }
        .whatsapp-float:hover {
            background-color: #128c7e;
        }

        /* Aviso de Pago Fijo (reemplaza a bank-info) */
        .fixed-payment-info {
            position: fixed;
            bottom: 0;
            right: 0; 
            background-color: #34495e;
            color: white;
            padding: 10px 15px;
            border-top-left-radius: 8px;
            font-size: 0.85em;
            z-index: 99;
            text-align: right;
            max-width: 350px;
        }
        .fixed-payment-info strong { color: #f1c40f; }
        .fixed-payment-info p { margin: 2px 0; }

        /* Estilos del panel de admin */
        .request-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .request-actions button {
            width: auto;
            padding: 8px 12px;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .btn-authorize { background-color: #3498db; }
        .btn-reject { background-color: #c0392b; }
        .download-link-box {
            background-color: #f0f0f0;
            border: 1px dashed #3498db;
            padding: 10px;
            margin-top: 10px;
            word-break: break-all;
            font-size: 0.9em;
        }
        
        /* Estilos para la sección de tratamiento dinámico */
        .tratamiento-entry {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
        }
        .tratamiento-entry input {
            flex: 1;
            margin-bottom: 0; /* Ajustar el margen para la lista */
        }
        #tratamientoContainer {
            margin-top: 10px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body onload="showForm('menu')">

    <h1>📝 Generador de Documentos y Solicitudes</h1>
    
    <div class="disclaimer-notice">
        *NO SE GARANTIZA NI SE RESPALDA EL DOCUMENTO, TODO ES BAJO SU PROPIA RESPONSABILIDAD*
    </div>
    
    <div id="app-container">
    
        <div id="main-menu">
            
            <h2>🌐 Acceso a Grupo y Soporte</h2>
            <button class="btn-menu btn-social" onclick="window.open('https://wa.me/525512345678', '_blank')">
                <i class="fab fa-whatsapp"></i> Unirse a nuestro Grupo de WhatsApp
            </button>
            
            <h2>✉️ Cartas de Recomendación</h2>
            <button class="btn-menu btn-carta" onclick="showForm('laboral')">Carta de Recomendación LABORAL</button>
            <button class="btn-menu btn-carta" onclick="showForm('personal')">Carta de Recomendación PERSONAL</button>
            
            <h2>💊 Documentos Médicos y Recetas</h2>
            <button class="btn-menu btn-receta" onclick="showForm('incapacidad_imss')">Incapacidad IMSS</button>
            <button class="btn-menu btn-receta" onclick="showForm('receta_similares')">Receta Médica SIMILARES</button>
            <button class="btn-menu btn-receta" onclick="showForm('receta_ahorro')">Receta Médica DEL AHORRO</button>
            <button class="btn-menu btn-receta" onclick="showForm('receta_imss')">Receta Médica IMSS</button>

            <h2>🎓 Certificados de Estudios</h2>
            <button class="btn-menu btn-certificado" onclick="showForm('cert_primaria')">Certificado de PRIMARIA</button>
            <button class="btn-menu btn-certificado" onclick="showForm('cert_secundaria')">Certificado de SECUNDARIA</button>
            <button class="btn-menu btn-certificado" onclick="showForm('cert_prepa')">Certificado de PREPARATORIA</button>
            
            <h2>⭐ Servicios Especializados</h2>
            <button class="btn-menu btn-especializado" onclick="showForm('metodo_shein')">Metodo Shein</button>
            <button class="btn-menu btn-especializado" onclick="showForm('metodo_cinepolis')">Metodo Cinépolis</button>
            <button class="btn-menu btn-especializado" onclick="showForm('metodo_temu')">Metodo TEMU</button>
            <button class="btn-menu btn-especializado" onclick="showForm('cv_desde_cero')">CV DESDE CERO</button>
            <button class="btn-menu btn-especializado" onclick="showForm('sellos_personales')">✍️ SELLOS PERSONALES</button>
            <button class="btn-menu btn-especializado" onclick="showForm('formato_solicitud_pdf')">🧑‍🔧 FORMATO DE SOLICITUD EN PDF</button>

            <button id="btn-go-admin" onclick="showForm('admin_login')">Acceso de Administrador</button>
        </div>

        <div id="admin-login" class="form-section">
            <button class="back-button" onclick="showForm('menu')">← Volver al Menú</button>
            <h2>🔒 Acceso del Administrador</h2>
            <p>Ingrese sus credenciales para autorizar las solicitudes.</p>
            
            <div class="input-group">
                <label for="adminUser">Usuario:</label>
                <input type="text" id="adminUser" placeholder="Ingrese su usuario">

                <label for="adminPass">Contraseña:</label>
                <input type="password" id="adminPass" placeholder="Ingrese su contraseña">
                
                <button class="btn-action" style="background-color: #2c3e50;" onclick="authenticateAdmin()">Iniciar Sesión</button>
            </div>
        </div>

        <div id="admin-dashboard" class="form-section">
            <button class="back-button" onclick="showForm('menu')">← Cerrar Sesión</button>
            <h2>⚙️ Panel de Autorización de Solicitudes</h2>
            <p>Al autorizar, el cliente verá automáticamente el botón de descarga en su página de espera.</p>

            <h3>Solicitudes Pendientes:</h3>
            <div id="pending-requests-list" class="input-group">
                <p id="no-requests-msg">No hay solicitudes pendientes en el almacenamiento local de este navegador.</p>
            </div>
        </div>

        <div id="form-laboral" class="form-section">
             <button class="back-button" onclick="showForm('menu')">← Volver al Menú</button>
             <div class="disclaimer-notice">
                 *NO SE GARANTIZA NI SE RESPALDA EL DOCUMENTO, TODO ES BAJO SU PROPIA RESPONSABILIDAD*
             </div>
             <div class="payment-notice">
                 *PARA CONTINUAR CON EL PAGO ENVIA MENSAJE AL WHATSAPP*
             </div>
             <h2>💼 Formulario de Carta Laboral</h2>
             <div class="input-group">
                 <h2>📝 Datos de la Solicitud</h2>
                 <label for="nombreSolicitanteLaboral">Tu Nombre Completo (Quien Pide la Carta):</label>
                 <input type="text" id="nombreSolicitanteLaboral" value="Nombre del Solicitante">
                 
                 <label for="emailSolicitanteLaboral">Tu Correo Electrónico (Solo para referencia):</label>
                 <input type="text" id="emailSolicitanteLaboral" value="solicitante@ejemplo.com">
             </div>
             
             <div class="input-group">
                 <h2>📂 Logo y Firma</h2>
                 <label for="logoInputLaboral">Insertar Logo de la Empresa:</label>
                 <input type="file" id="logoInputLaboral" accept="image/*">
                 
                 <label for="firmaInputLaboral">Insertar Firma:</label>
                 <input type="file" id="firmaInputLaboral" accept="image/*">
             </div>
             <div class="input-group">
                 <h2>👤 Datos del Empleado</h2>
                 <label for="fechaEmisionLaboral">Fecha de Emisión de la Carta:</label>
                 <input type="date" id="fechaEmisionLaboral" value="2025-10-23"> <label for="nombreEmpleadoLaboral">Nombre Completo del Empleado:</label>
                 <input type="text" id="nombreEmpleadoLaboral" value="JAIME LEONARDO GARCIA MENDEZ"> <label for="puestoDesempenadoLaboral">Puesto Desempeñado:</label>
                 <input type="text" id="puestoDesempenadoLaboral" value="ANALISTA DE MANTENIMIENTO"> <div class="date-container">
                     <div>
                         <label for="fechaInicioLaboral">Fecha de Inicio Laboral:</label>
                         <input type="date" id="fechaInicioLaboral" value="2024-09-08"> </div>
                     <div>
                         <label for="fechaFinLaboral">Fecha de Término Laboral:</label>
                         <input type="date" id="fechaFinLaboral" value="2025-11-09"> </div>
                 </div>
             </div>
             <div class="input-group">
                 <h2>📝 Contenido de la Carta</h2>
                 <label for="nombreEmpresaLaboral">Nombre de la Empresa:</label>
                 <input type="text" id="nombreEmpresaLaboral" value="LARIMEX"> <label for="cuerpoPersonalidadLaboral">Párrafo de Personalidad y Habilidades:</label>
                 <textarea id="cuerpoPersonalidadLaboral">Durante el tiempo que trabajó con nosotros, [nombre] demostró ser una persona responsable, proactiva y comprometida con su trabajo. Su disposición para aprender y colaborar fue excelente, adaptándose de forma eficaz a las exigencias de los diferentes proyectos. Su desempeño siempre fue satisfactorio y su actitud de trabajo en equipo fue un gran aporte.</textarea>
                 
                 <label for="tareasLaboral">Tareas Principales (una por línea):</label>
                 <textarea id="tareasLaboral">Preparación de materiales: Ayudó a organizar y preparar cemento, mezcla y otros materiales esenciales para las labores de construcción.
Asistencia en albañilería: Apoyó a los maestros de obra en la preparación y colocación de ladrillos, bloques y otros elementos estructurales.
Mantenimiento del área de trabajo: Colaboró activamente en la limpieza y el orden de la obra, asegurando un ambiente de trabajo seguro y eficiente.
Traslado de equipo y herramientas: Ayudó a mover y distribuir herramientas y equipo pesado, demostrando fuerza y precaución.</textarea>
                 
                 <label for="cuerpoCierreLaboral">Párrafo de Recomendación y Cierre:</label>
                 <textarea id="cuerpoCierreLaboral">Considero que [nombre] es un empleado valioso, con la capacidad y el deseo de crecer profesionalmente. Recomiendo su contratación para cualquier puesto que se ajuste a su perfil, pues estoy seguro que será un gran activo para cualquier equipo.

Para cualquier duda o aclaración, estoy a su disposición.</textarea>
             </div>
             <div class="input-group">
                 <h2>✍️ Datos del Firmante</h2>
                 <label for="nombreFirmanteLaboral">Nombre Completo del Firmante:</label>
                 <input type="text" id="nombreFirmanteLaboral" value="JOSE GARCIA CHAIDEZ">

                 <label for="cargoFirmanteLaboral">Cargo del Firmante:</label>
                 <input type="text" id="cargoFirmanteLaboral" value="Director de Recursos Humanos">

                 <label for="telefonoFirmanteLaboral">Teléfono de Contacto:</label>
                 <input type="text" id="telefonoFirmanteLaboral" value="T. (442) 880 1675">
             </div>

             <button class="btn-action" onclick="saveSolicitud('laboral')">💾 Guardar Solicitud (Esperar Aprobación)</button>
        </div>

        <div id="form-personal" class="form-section">
            <button class="back-button" onclick="showForm('menu')">← Volver al Menú</button>
            <div class="disclaimer-notice">
                *NO SE GARANTIZA NI SE RESPALDA EL DOCUMENTO, TODO ES BAJO SU PROPIA RESPONSABILIDAD*
            </div>
            <div class="payment-notice">
                *PARA CONTINUAR CON EL PAGO ENVIA MENSAJE AL WHATSAPP*
            </div>
            <h2>🏠 Formulario de Carta Personal</h2>
            <div class="input-group">
                <h2>📝 Datos de la Solicitud</h2>
                <label for="nombreSolicitantePersonal">Tu Nombre Completo (Quien Pide la Carta):</label>
                <input type="text" id="nombreSolicitantePersonal" value="Nombre del Solicitante">

                <label for="emailSolicitantePersonal">Tu Correo Electrónico (Solo para referencia):</label>
                <input type="text" id="emailSolicitantePersonal" value="solicitante@ejemplo.com">
            </div>
            
            <div class="input-group">
                <h2>✍️ Datos del Firmante (Recomendador)</h2>
                <label for="fechaEmisionPersonal">Fecha de Emisión de la Carta:</label>
                <input type="date" id="fechaEmisionPersonal" value="2025-10-24">

                <label for="nombreFirmantePersonal">Nombre Completo del Recomendador:</label>
                <input type="text" id="nombreFirmantePersonal" value="MARIA ISABEL LÓPEZ PÉREZ">
                
                <label for="firmaInputPersonal">Insertar Firma del Recomendador:</label>
                <input type="file" id="firmaInputPersonal" accept="image/*">
            </div>
            <div class="input-group">
                <h2>👤 Datos de la Persona Recomendada</h2>
                <label for="nombreRecomendadoPersonal">Nombre Completo de la Persona Recomendada:</label>
                <input type="text" id="nombreRecomendadoPersonal" value="JUAN CARLOS RAMÍREZ SOTO">

                <label for="tiempoConocidoPersonal">Tiempo que conoce a la persona (Ej: 5 años):</label>
                <input type="text" id="tiempoConocidoPersonal" value="Desde hace 8 años">
            </div>
            <div class="input-group">
                <h2>📝 Contenido de la Carta</h2>
                
                <label for="cuerpoPersonalidadPersonal">Párrafo de Cualidades y Personalidad:</label>
                <textarea id="cuerpoPersonalidadPersonal">Conozco a [nombre] desde hace 8 años en un contexto social y comunitario. Siempre ha demostrado ser una persona de gran integridad, honesta y de palabra. Destaca por su madurez, su compromiso en las actividades que realiza y su excelente trato interpersonal. Es alguien en quien se puede confiar plenamente.</textarea>
                
                <label for="cuerpoRecomendacionPersonal">Párrafo de Recomendación y Cierre:</label>
                <textarea id="cuerpoRecomendacionPersonal">Recomiendo a [nombre] sin ninguna reserva para cualquier propósito que requiera de una persona con sólidos valores y ética. Estoy seguro/a de que su carácter y responsabilidad serán de gran valor.

Para cualquier duda o aclaración, estoy a su disposición.</textarea>
            </div>

            <button class="btn-action" onclick="saveSolicitud('personal')">💾 Guardar Solicitud (Esperar Aprobación)</button>
        </div>
        
        <div id="form-receta_similares" class="form-section">
            <button class="back-button" onclick="showForm('menu')">← Volver al Menú</button>
            <div class="disclaimer-notice">
                *NO SE GARANTIZA NI SE RESPALDA EL DOCUMENTO, TODO ES BAJO SU PROPIA RESPONSABILIDAD*
            </div>
            <div class="payment-notice">
                *PARA CONTINUAR CON EL PAGO ENVIA MENSAJE AL WHATSAPP*
            </div>
            <h2>💊 Formulario de Receta Médica SIMILARES</h2>
            
            <div class="input-group">
                <h2>👨‍⚕️ Datos del Médico y Emisión</h2>
                <label for="doctorNombreSimilares">Nombre del Médico:</label>
                <input type="text" id="doctorNombreSimilares" value="Dr. DUARTE ABDALA MARIO RAFAEL">

                <label for="cedulaSimilares">Cédula Profesional / Prof. / Especialidad:</label>
                <input type="text" id="cedulaSimilares" value="MEDICO SUB ESPECIALISTA / PROF.: 5164506">

                <label for="direccionSimilares">Dirección del Consultorio:</label>
                <input type="text" id="direccionSimilares" value="AV. PDTE. PLUTARCO ELÍAS CALLES 1613, COL. ALBERT. C.P. 03560, BENITO JUAREZ">

                <label for="ciudadSimilares">Ciudad:</label>
                <input type="text" id="ciudadSimilares" value="CIUDAD DE MÉXICO">

                <label for="fechaEmisionSimilares">Fecha de Emisión de la Receta (AAAA-MM-DD):</label>
                <input type="date" id="fechaEmisionSimilares" value="2021-03-22">
                
                <label for="logoInputSimilares">Insertar Logo de la Institución/Receta (Opcional):</label>
                <input type="file" id="logoInputSimilares" accept="image/*">
            </div>

            <div class="input-group">
                <h2>👤 Datos del Paciente</h2>
                <label for="nombrePacienteSimilares">Nombre(s) del Paciente:</label>
                <input type="text" id="nombrePacienteSimilares" value="JHOANA MUZME">
                
                <div class="date-container">
                    <div>
                        <label for="apellidoPSimilares">Apellido Paterno:</label>
                        <input type="text" id="apellidoPSimilares" value="SANCHEZ">
                    </div>
                    <div>
                        <label for="apellidoMSimilares">Apellido Materno:</label>
                        <input type="text" id="apellidoMSimilares" value="LARA">
                    </div>
                </div>
                
                <div class="date-container">
                    <div>
                        <label for="sexoSimilares">Sexo:</label>
                        <input type="text" id="sexoSimilares" value="FEMENINO">
                    </div>
                    <div>
                        <label for="edadSimilares">Edad:</label>
                        <input type="text" id="edadSimilares" value="18 AÑOS">
                    </div>
                </div>
                
                <label for="fechaNacSimilares">Fecha de Nacimiento (AAAA-MM-DD):</label>
                <input type="date" id="fechaNacSimilares" value="2002-09-26">

                <label for="alergiasSimilares">Alergias:</label>
                <input type="text" id="alergiasSimilares" value="NEGADAS">
            </div>
            
            <div class="input-group">
                <h2>📈 Signos Vitales y Medidas</h2>
                <div class="date-container">
                    <div>
                        <label for="spo2Similares">SpO2 (Ej: 99%):</label>
                        <input type="text" id="spo2Similares" value="99%">
                    </div>
                    <div>
                        <label for="fcSimilares">F.C. (Ej: 78 x min.):</label>
                        <input type="text" id="fcSimilares" value="73 xmin">
                    </div>
                </div>
                <div class="date-container">
                    <div>
                        <label for="frSimilares">F.R. (Ej: 20 x min.):</label>
                        <input type="text" id="frSimilares" value="20 xmin">
                    </div>
                    <div>
                        <label for="tempSimilares">Temp. (Ej: 36.5°C):</label>
                        <input type="text" id="tempSimilares" value="36.5°C">
                    </div>
                </div>
                <div class="date-container">
                    <div>
                        <label for="pesoSimilares">Peso (Ej: 78 Kg):</label>
                        <input type="text" id="pesoSimilares" value="78 Kg">
                    </div>
                    <div>
                        <label for="tallaSimilares">Talla (Ej: 1.60 M):</label>
                        <input type="text" id="tallaSimilares" value="1.60 M">
                    </div>
                </div>
                <label for="dxSimilares">Diagnóstico/I.D.:</label>
                <input type="text" id="dxSimilares" value="I.D. DISPEPSIA FUNCIONAL">
            </div>
            
            <div class="input-group">
                <h2>📝 Contenido de la Receta</h2>
                <label for="contenidoConsultaSimilares">Motivo/Contenido de la Consulta:</label>
                <textarea id="contenidoConsultaSimilares">Paciente acude a consulta médica con dolor abdominal, diarrea con episodios agudos y malestar general. Esto debido a alguna toxina de algún alimento. Sin presentar fiebre.</textarea>

                <hr>
                <h3>Tratamiento (Fila por Fila)</h3>
                <div id="tratamientoContainer">
                    <div class="tratamiento-entry">
                        <input type="text" class="medicamento" value="TRIMETOPRINA 800 MG" placeholder="Medicamento">
                        <input type="text" class="dosis" value="UNA CADA 8HRS DURANTE 10 DIAS" placeholder="Dosis/Indicaciones">
                        <input type="text" class="via" value="VIA DE ADMINISTRACION ORAL" placeholder="Vía">
                        <button type="button" onclick="removeTratamiento(this)">-</button>
                    </div>
                    <div class="tratamiento-entry">
                        <input type="text" class="medicamento" value="BUTILHIOSCINA 20 MG" placeholder="Medicamento">
                        <input type="text" class="dosis" value="UNA CADA 12 HRS DURANTE 5 DIAS" placeholder="Dosis/Indicaciones">
                        <input type="text" class="via" value="VIA DE ADMINISTRACION ORAL" placeholder="Vía">
                        <button type="button" onclick="removeTratamiento(this)">-</button>
                    </div>
                    <div class="tratamiento-entry">
                        <input type="text" class="medicamento" value="DIFENIDOL 50 MG" placeholder="Medicamento">
                        <input type="text" class="dosis" value="UNA CADA 12 HRS DURANE 3 DIAS" placeholder="Dosis/Indicaciones">
                        <input type="text" class="via" value="VIA DE ADMINISTRACION ORAL" placeholder="Vía">
                        <button type="button" onclick="removeTratamiento(this)">-</button>
                    </div>
                    <div class="tratamiento-entry">
                        <input type="text" class="medicamento" value="PARACETAMOL 500 MG" placeholder="Medicamento">
                        <input type="text" class="dosis" value="UNA CADA 12 HRSDURANTE 5 DIAS" placeholder="Dosis/Indicaciones">
                        <input type="text" class="via" value="VIA DE ADMINISTRACION ORAL" placeholder="Vía">
                        <button type="button" onclick="removeTratamiento(this)">-</button>
                    </div>
                </div>
                <button type="button" class="btn-action back-button" onclick="addTratamiento()">+ Agregar Medicamento</button>
                <hr>
                
                <label for="indicacionesGeneralesSimilares">Indicaciones Generales:</label>
                <textarea id="indicacionesGeneralesSimilares">1 Día en reposo</textarea>
                
                <label for="proximaCitaSimilares">Próxima Cita (Ej: 27/03/2021):</label>
                <input type="text" id="proximaCitaSimilares" value="27/03/2021">

                <label for="firmaInputSimilares">Insertar Firma del Médico (Opcional):</label>
                <input type="file" id="firmaInputSimilares" accept="image/*">
            </div>
            
            <button class="btn-action" style="background-color: #007bff;" onclick="generarPDFRecetaSimilares()">🚀 Generar Receta PDF (Local)</button>
            <button class="btn-action" onclick="saveSolicitud('receta_similares')">💾 Guardar Solicitud (Esperar Aprobación)</button>
        </div>


        <div id="form-incapacidad_imss" class="form-section">
            <button class="back-button" onclick="showForm('menu')">← Volver al Menú</button>
            <div class="disclaimer-notice">
                *NO SE GARANTIZA NI SE RESPALDA EL DOCUMENTO, TODO ES BAJO SU PROPIA RESPONSABILIDAD*
            </div>
            <div class="payment-notice">
                *PARA CONTINUAR CON EL PAGO ENVIA MENSAJE AL WHATSAPP*
            </div>
            <h2>💊 Formulario de Incapacidad IMSS</h2>
            <div class="input-group">
                <p>⚠️ **FORMULARIO PENDIENTE:** Agregue los campos específicos para la Incapacidad IMSS aquí.</p>
                <label for="placeholder1_incapacidad">Ejemplo de Campo (a borrar):</label>
                <input type="text" id="placeholder1_incapacidad" value="">
            </div>
            <button class="btn-action" onclick="saveSolicitud('incapacidad_imss')">💾 Guardar Solicitud</button>
        </div>
        
        <div id="form-receta_ahorro" class="form-section">
            <button class="back-button" onclick="showForm('menu')">← Volver al Menú</button>
            <div class="disclaimer-notice">
                *NO SE GARANTIZA NI SE RESPALDA EL DOCUMENTO, TODO ES BAJO SU PROPIA RESPONSABILIDAD*
            </div>
            <div class="payment-notice">
                *PARA CONTINUAR CON EL PAGO ENVIA MENSAJE AL WHATSAPP*
            </div>
            <h2>💊 Formulario de Receta Médica DEL AHORRO</h2>
            <div class="input-group">
                <p>⚠️ **FORMULARIO PENDIENTE:** Agregue los campos específicos para la Receta Del Ahorro aquí.</p>
                <label for="placeholder1_ahorro">Ejemplo de Campo (a borrar):</label>
                <input type="text" id="placeholder1_ahorro" value="">
            </div>
            <button class="btn-action" onclick="saveSolicitud('receta_ahorro')">💾 Guardar Solicitud</button>
        </div>
        
        <div id="form-receta_imss" class="form-section">
            <button class="back-button" onclick="showForm('menu')">← Volver al Menú</button>
            <div class="disclaimer-notice">
                *NO SE GARANTIZA NI SE RESPALDA EL DOCUMENTO, TODO ES BAJO SU PROPIA RESPONSABILIDAD*
            </div>
            <div class="payment-notice">
                *PARA CONTINUAR CON EL PAGO ENVIA MENSAJE AL WHATSAPP*
            </div>
            <h2>💊 Formulario de Receta Médica IMSS</h2>
            <div class="input-group">
                <p>⚠️ **FORMULARIO PENDIENTE:** Agregue los campos específicos para la Receta IMSS aquí.</p>
                <label for="placeholder1_imss">Ejemplo de Campo (a borrar):</label>
                <input type="text" id="placeholder1_imss" value="">
            </div>
            <button class="btn-action" onclick="saveSolicitud('receta_imss')">💾 Guardar Solicitud</button>
        </div>
        </div> <a href="https://wa.me/525512345678" class="whatsapp-float" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>
    <div class="fixed-payment-info">
        <strong>¡IMPORTANTE!</strong>
        <p>Para iniciar la solicitud y generar el documento, debe enviar el comprobante de pago por WhatsApp (icono flotante a la izquierda).</p>
    </div>
    
    <div id="status-page" class="status-page" style="display:none;">
        <h2>Estatus de su Solicitud</h2>
        <div id="status-content"></div>
        <button class="btn-action back-button" onclick="showForm('menu')">← Volver al Menú Principal</button>
    </div>

    <script>
        const { jsPDF } = window.jspdf;
        const ADMIN_USER = 'admin';
        const ADMIN_PASS = '12345'; // Contraseña de ejemplo
        const ALL_FORMS = [
            'main-menu', 'admin-login', 'admin-dashboard', 'status-page',
            'form-laboral', 'form-personal', 'form-receta_similares',
            'form-incapacidad_imss', 'form-receta_ahorro', 'form-receta_imss'
        ];

        // Función principal para cambiar de vista (Menú, Formulario, Admin, Estatus)
        function showForm(formId, requestId = null) {
            ALL_FORMS.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });

            const targetElement = document.getElementById(formId);
            if (targetElement) {
                targetElement.style.display = 'block';
            }
            
            // Lógica específica para el dashboard y el estatus
            if (formId === 'admin-dashboard') {
                renderAdminDashboard();
            } else if (formId === 'status-page' && requestId) {
                checkStatus(requestId);
            }
        }
        
        // Genera un ID único basado en el tiempo
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }

        // FUNCIÓN CENTRAL: Guarda la solicitud en localStorage y muestra la página de estatus.
        function saveSolicitud(type) {
            const requestId = generateId();
            const formElementId = `form-${type}`;
            const formInputs = document.querySelectorAll(`#${formElementId} input, #${formElementId} textarea`);
            
            let data = { type: type, status: 'PENDIENTE', timestamp: new Date().toLocaleString() };

            formInputs.forEach(input => {
                if (input.type !== 'file') {
                    data[input.id] = input.value;
                }
            });

            // Manejo especial para el tratamiento dinámico (solo Similares)
            if (type === 'receta_similares') {
                const tratamientoEntries = document.querySelectorAll('#tratamientoContainer .tratamiento-entry');
                data.tratamiento = Array.from(tratamientoEntries).map(entry => ({
                    medicamento: entry.querySelector('.medicamento').value,
                    dosis: entry.querySelector('.dosis').value,
                    via: entry.querySelector('.via').value
                }));
            }

            // Guardar en localStorage
            let requests = JSON.parse(localStorage.getItem('requests')) || {};
            requests[requestId] = data;
            localStorage.setItem('requests', JSON.stringify(requests));
            
            // Mostrar página de estatus al cliente
            alert(`✅ Solicitud Guardada. Su código de seguimiento es:\n\n${requestId}\n\nEspere la aprobación.`);
            showForm('status-page', requestId);
        }
        
        // Muestra el estatus de la solicitud al cliente
        function checkStatus(requestId) {
            const requests = JSON.parse(localStorage.getItem('requests')) || {};
            const request = requests[requestId];
            const statusContent = document.getElementById('status-content');
            
            if (!request) {
                statusContent.innerHTML = `<p style="color: red; font-weight: bold;">❌ Solicitud no encontrada para el código: ${requestId}</p>`;
                return;
            }

            let html = `
                <p><strong>Tipo de Documento:</strong> ${request.type.toUpperCase().replace('_', ' ')}</p>
                <p><strong>Fecha de Solicitud:</strong> ${request.timestamp}</p>
                <p><strong>Estado Actual:</strong> <span style="font-size: 1.2em; font-weight: bold;">${request.status}</span></p>
            `;
            
            if (request.status === 'APROBADA') {
                // Aquí se simula el link de descarga
                html += `
                    <p style="color: green; font-weight: bold; margin-top: 20px;">🎉 ¡Su documento ha sido APROBADO!</p>
                    <button class="btn-action btn-download-now" onclick="downloadPDF('${requestId}')">
                        <i class="fas fa-download"></i> Descargar Documento Ahora
                    </button>
                `;
            } else if (request.status === 'PENDIENTE') {
                 html += `
                    <div class="spinner"></div>
                    <p style="color: orange; font-weight: bold;">⏳ Su solicitud está en proceso de revisión por el administrador.</p>
                    <p>Por favor, espere a que sea autorizada. Puede volver a esta página más tarde para verificar.</p>
                `;
            } else if (request.status === 'RECHAZADA') {
                 html += `<p style="color: red; font-weight: bold; margin-top: 20px;">🛑 Su solicitud ha sido RECHAZADA. Contacte al administrador.</p>`;
            }
            
            statusContent.innerHTML = html;
        }

        // Simulación de descarga (Genera PDF en el momento para Receta Similares)
        function downloadPDF(requestId) {
            const requests = JSON.parse(localStorage.getItem('requests')) || {};
            const request = requests[requestId];

            if (!request || request.status !== 'APROBADA') {
                alert('El documento no está autorizado o no existe.');
                return;
            }

            if (request.type === 'receta_similares') {
                // Llama a la función de generación de PDF con los datos guardados
                generarPDFRecetaSimilares(request);
            } else {
                // Para otros tipos de documentos, solo simula la descarga
                alert(`Descargando ${request.type.toUpperCase().replace('_', ' ')}... (Simulación)`);
            }
        }
        
        // ******************** Lógica de Administrador ********************

        function authenticateAdmin() {
            const user = document.getElementById('adminUser').value;
            const pass = document.getElementById('adminPass').value;

            if (user === ADMIN_USER && pass === ADMIN_PASS) {
                alert('✅ Acceso correcto.');
                showForm('admin-dashboard');
            } else {
                alert('❌ Usuario o contraseña incorrectos.');
            }
        }
        
        function renderAdminDashboard() {
            const requests = JSON.parse(localStorage.getItem('requests')) || {};
            const listContainer = document.getElementById('pending-requests-list');
            listContainer.innerHTML = '';
            
            let pendingCount = 0;
            
            for (const id in requests) {
                const req = requests[id];
                
                if (req.status === 'PENDIENTE') {
                    pendingCount++;
                    
                    const item = document.createElement('div');
                    item.className = 'request-item';
                    item.innerHTML = `
                        <div>
                            <strong>ID:</strong> ${id}<br>
                            <strong>Tipo:</strong> ${req.type.toUpperCase().replace('_', ' ')}<br>
                            <strong>Solicitante:</strong> ${req.nombreSolicitanteLaboral || req.nombreSolicitantePersonal || req.nombrePacienteSimilares || 'N/A'}<br>
                            <a href="#" onclick="viewRequestDetails('${id}')" style="font-size: 0.9em;">Ver Detalles</a>
                        </div>
                        <div class="request-actions">
                            <button class="btn-action btn-authorize" style="background-color: #27ae60;" onclick="adminAuthorize('${id}')">Aprobar</button>
                            <button class="btn-action btn-reject" style="background-color: #c0392b;" onclick="adminReject('${id}')">Rechazar</button>
                        </div>
                    `;
                    listContainer.appendChild(item);
                }
            }
            
            document.getElementById('no-requests-msg').style.display = pendingCount === 0 ? 'block' : 'none';
        }

        function viewRequestDetails(id) {
            const requests = JSON.parse(localStorage.getItem('requests')) || {};
            const request = requests[id];
            
            let details = `ID de Solicitud: ${id}\nTipo: ${request.type.toUpperCase().replace('_', ' ')}\nEstatus: ${request.status}\n\n`;
            
            for (const key in request) {
                if (key !== 'type' && key !== 'status' && key !== 'tratamiento') {
                    details += `${key}: ${request[key]}\n`;
                } else if (key === 'tratamiento') {
                    details += '\n--- TRATAMIENTO ---\n';
                    request.tratamiento.forEach((t, index) => {
                        details += `\t${index + 1}. ${t.medicamento} - ${t.dosis} (${t.via})\n`;
                    });
                }
            }
            alert(details);
        }

        function updateRequestStatus(requestId, status) {
            let requests = JSON.parse(localStorage.getItem('requests')) || {};
            if (requests[requestId]) {
                requests[requestId].status = status;
                localStorage.setItem('requests', JSON.stringify(requests));
                renderAdminDashboard();
            }
        }

        function adminAuthorize(requestId) {
            if (confirm(`¿Está seguro de autorizar la solicitud ${requestId}? Esto permitirá la descarga.`)) {
                updateRequestStatus(requestId, 'APROBADA');
            }
        }

        function adminReject(requestId) {
            if (confirm(`¿Está seguro de rechazar la solicitud ${requestId}?`)) {
                updateRequestStatus(requestId, 'RECHAZADA');
            }
        }
        
        // ******************** Lógica de Formularios Dinámicos ********************

        // Añade una nueva fila de tratamiento a la Receta Similares
        function addTratamiento() {
            const container = document.getElementById('tratamientoContainer');
            const newEntry = document.createElement('div');
            newEntry.className = 'tratamiento-entry';
            newEntry.innerHTML = `
                <input type="text" class="medicamento" value="" placeholder="Medicamento">
                <input type="text" class="dosis" value="" placeholder="Dosis/Indicaciones">
                <input type="text" class="via" value="" placeholder="Vía">
                <button type="button" onclick="removeTratamiento(this)">-</button>
            `;
            container.appendChild(newEntry);
        }

        // Elimina una fila de tratamiento
        function removeTratamiento(button) {
            const entry = button.parentNode;
            entry.remove();
        }

        // ******************** Generación de PDF (Receta Similares) ********************
        
        // Función de generación de PDF usando jspdf
        function generarPDFRecetaSimilares(data = null) {
            // Si no se pasa data (llamada desde el formulario), se usan los valores actuales del formulario
            // Si se pasa data (llamada desde el estatus APROBADA), se usan los valores guardados
            let req = data;
            if (!req) {
                 // Recoger datos del formulario (esto es una simplificación)
                 const formId = 'form-receta_similares';
                 const formInputs = document.querySelectorAll(`#${formId} input, #${formId} textarea`);
                 req = {};
                 formInputs.forEach(input => {
                    if (input.type !== 'file') {
                        req[input.id] = input.value;
                    }
                 });
                 req.tratamiento = Array.from(document.querySelectorAll('#tratamientoContainer .tratamiento-entry')).map(entry => ({
                    medicamento: entry.querySelector('.medicamento').value,
                    dosis: entry.querySelector('.dosis').value,
                    via: entry.querySelector('.via').value
                }));
            }
            
            // --- INICIO DE LA LÓGICA DEL PDF ---
            const doc = new jsPDF();
            const margin = 20;
            let y = margin;
            const lineHeight = 5;
            const pageWidth = doc.internal.pageSize.getWidth();

            // Formatear la fecha
            const fechaEmision = req.fechaEmisionSimilares.split('-').reverse().join('/');
            const fechaNac = req.fechaNacSimilares.split('-').reverse().join('/');

            // Título y Código
            doc.setFontSize(24).setFont(undefined, 'bold');
            doc.text("RECETA", pageWidth - margin, y, { align: "right" });
            y += lineHeight;
            doc.setFontSize(10).setFont(undefined, 'normal');
            doc.text("00050822531", pageWidth - margin, y, { align: "right" });
            y += lineHeight * 2;

            // Datos del Médico (Encabezado)
            doc.setFontSize(10).setFont(undefined, 'normal');
            doc.text("UNIDOS PARA AYUDAR", margin, margin, { align: "left" });
            doc.setFontSize(10).setFont(undefined, 'bold');
            doc.text(`Dr. (a) ${req.doctorNombreSimilares.toUpperCase()}`, margin, y);
            y += lineHeight;
            doc.setFont(undefined, 'normal');
            doc.text(req.cedulaSimilares.toUpperCase(), margin, y);
            y += lineHeight;
            doc.text("UNIVERSIDAD NACIONAL AUTONOMA DE MEXICO", margin, y);
            y += lineHeight;
            doc.text(req.direccionSimilares.toUpperCase(), margin, y);
            y += lineHeight;
            doc.text(req.ciudadSimilares.toUpperCase(), margin, y);
            doc.text(`FECHA: ${fechaEmision}`, pageWidth - margin, y, { align: "right" });
            y += lineHeight * 2;
            doc.line(margin, y - 5, pageWidth - margin, y - 5); // Línea divisoria

            // Datos del Paciente
            doc.setFontSize(10).setFont(undefined, 'normal');
            doc.text(`Nombre(s): ${req.nombrePacienteSimilares.toUpperCase()}`, margin, y);
            doc.text(`Apellido Paterno: ${req.apellidoPSimilares.toUpperCase()}`, margin + 60, y);
            doc.text(`Apellido Materno: ${req.apellidoMSimilares.toUpperCase()}`, margin + 120, y);
            y += lineHeight;

            doc.text(`Sexo: ${req.sexoSimilares.toUpperCase()}`, margin, y);
            doc.text(`Edad: ${req.edadSimilares.toUpperCase()}`, margin + 40, y);
            doc.text(`Fecha de Nacimiento: ${fechaNac}`, margin + 80, y);
            y += lineHeight;
            
            doc.text(`SpO2: ${req.spo2Similares}`, margin, y);
            doc.text(`F.C.: ${req.fcSimilares}`, margin + 30, y);
            doc.text(`F.R.: ${req.frSimilares}`, margin + 60, y);
            doc.text(`Temp.: ${req.tempSimilares}`, margin + 90, y);
            doc.text(`Peso: ${req.pesoSimilares}`, margin + 120, y);
            doc.text(`Talla: ${req.tallaSimilares}`, margin + 150, y);
            y += lineHeight;

            doc.text(`*I.D.: ${req.dxSimilares.toUpperCase()}`, margin, y);
            doc.text(`*Alergias: ${req.alergiasSimilares.toUpperCase()}`, margin + 80, y);
            y += lineHeight;

            // Motivo de Consulta
            y += 5;
            doc.setFont(undefined, 'bold');
            doc.text('Motivo de Consulta:', margin, y);
            y += 2;
            doc.setFont(undefined, 'normal');
            const splitMotivo = doc.splitTextToSize(req.contenidoConsultaSimilares, pageWidth - margin * 2);
            doc.text(splitMotivo, margin, y);
            y += (splitMotivo.length * lineHeight) + 2;


            // Tratamiento
            doc.rect(margin, y, pageWidth - margin * 2, 70); // Caja del tratamiento
            let treatmentY = y + 5;
            doc.setFont(undefined, 'bold');
            doc.text("TRATAMIENTO:", margin + 5, treatmentY);
            treatmentY += 5;
            doc.setFont(undefined, 'normal');

            req.tratamiento.forEach((t, index) => {
                const text = `${index + 1}.- ${t.medicamento.toUpperCase()} - ${t.dosis.toUpperCase()} / ${t.via.toUpperCase()}`;
                const splitText = doc.splitTextToSize(text, pageWidth - margin * 2 - 10);
                doc.text(splitText, margin + 5, treatmentY);
                treatmentY += splitText.length * lineHeight;
            });
            
            y += 70; // Ajustar la posición después de la caja de tratamiento
            
            // Indicaciones y Cita
            doc.setFont(undefined, 'normal');
            doc.text(`Indicaciones Generales: ${req.indicacionesGeneralesSimilares}`, margin, y + 5);
            doc.text(`FAVOR DE PRESENTAR ESTA RECETA EN SU PROXIMA CITA: ${req.proximaCitaSimilares}`, margin, y + 10);
            y += 15;

            // Firma
            const firmaX = pageWidth - margin - 50;
            doc.line(firmaX, y + 20, pageWidth - margin, y + 20);
            doc.text("Firma:", firmaX - 10, y + 25);

            // Pie de página (Copia)
            doc.setFontSize(14).setFont(undefined, 'bold');
            doc.text("COPIA", pageWidth / 2, y + 40, { align: "center" });

            // Guardar el PDF
            doc.save(`Receta_Similares_${req.nombrePacienteSimilares.replace(/\s/g, '_')}_${fechaEmision.replace(/\//g, '-')}.pdf`);
            // --- FIN DE LA LÓGICA DEL PDF ---
        }
        
        // Ejecuta la función principal al cargar la página.
        window.onload = function() {
             // Esto mantiene el formulario limpio si no hay lógica de inicio de sesión real
             // Si el usuario llega a una URL con ID de solicitud, debe redirigirse al estatus.
             const urlParams = new URLSearchParams(window.location.search);
             const requestId = urlParams.get('id');

             if (requestId) {
                 showForm('status-page', requestId);
             } else {
                 showForm('main-menu');
             }
        }
    </script>
</body>
</html>
